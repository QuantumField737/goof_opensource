name: SBOM Generation

on:
  push:

jobs:
  generate-sbom:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Install Snyk CLI
        run: npm install -g snyk
      - name: Authenticate Snyk CLI
        run: snyk auth ${{ secrets.SNYK_API_TOKEN }}
      - name: Generate SBOM
        run: |
          mkdir -p sbom
          sbom_filename="mySBOM_$(date +'%Y%m%d_%H%M%S')_${{ github.run_id }}.json"
          snyk sbom --format=cyclonedx1.5+json --json-file-output ./sbom/$sbom_filename
      - name: Archive SBOM
        uses: actions/upload-artifact@v2
        with:
          name: sbom-file
          path: ./sbom/$sbom_filename
